
<!DOCTYPE html>
<html lang="en">
<head>
  
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.54.0" />

    
    
    

<title>4 ways to set up datasources in Jboss AS 7 • A Morsel Of Code</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="4 ways to set up datasources in Jboss AS 7"/>
<meta name="twitter:description" content="Last year my company decided to move from JBoss 4.x/5.x to Jboss AS 7. We use Maven and IZPack plugin to create automated deployment to Jboss 4. As a part of IZPack plugin, we would write the install.xmls for various environment, which would help us deploy war files, log.xml, jars, properties file in respective folders. So the advantage was that Jboss-4 allows you to deploy several xxx-ds.xml files in deploy folder and you can have multiple apps deployed in same Jboss and each app uses it&#8217;s respective xxx-ds."/>

<meta property="og:title" content="4 ways to set up datasources in Jboss AS 7" />
<meta property="og:description" content="Last year my company decided to move from JBoss 4.x/5.x to Jboss AS 7. We use Maven and IZPack plugin to create automated deployment to Jboss 4. As a part of IZPack plugin, we would write the install.xmls for various environment, which would help us deploy war files, log.xml, jars, properties file in respective folders. So the advantage was that Jboss-4 allows you to deploy several xxx-ds.xml files in deploy folder and you can have multiple apps deployed in same Jboss and each app uses it&#8217;s respective xxx-ds." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2015/07/22/4-ways-to-set-up-datasources-in-jboss-as-7/" />
<meta property="article:published_time" content="2015-07-22T04:44:20&#43;00:00"/>
<meta property="article:modified_time" content="2015-07-22T04:44:20&#43;00:00"/>



<link rel="canonical" href="/2015/07/22/4-ways-to-set-up-datasources-in-jboss-as-7/" />

<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">





<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Allerta+Stencil">

<link rel="stylesheet" href="/css/w3.css" />


<link rel="stylesheet" href="/css/style.css" />









  
  
</head>
<body class="w3-light-grey">


    
    <header id="header">
         
          
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-47631412-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-47631412-1');
</script>

<div class="w3-right ">
<div class="w3-bar w3-light-grey  ">
  
  <span class="w3-bar-item w3-left " id="google_translate_element"></span>
<script>
  function googleTranslateElementInit() {
    new google.translate.TranslateElement(
      {
          pageLanguage: 'en'
        , layout: google.translate.TranslateElement.FloatPosition.TOP_RIGHT
        , multilanguagePage: true
      }
      , 'google_translate_element'
    );
  }
</script>
<script async src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


  
       <a href="javascript:void(0)" class="w3-bar-item w3-button w3-hover-green" title="Search" onclick="displaysearch()"><i class="fa fa-search"></i></a>
  
      <span class="w3-hide-small">

        <a href="mailto:dinesh19aug@gmail.com" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-envelope"></i></a>

        <a href="%3ch4%3eDinesh%20Arora%3c/h4%3e" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-thorinfo"></i></a>

        <a href="https://stackoverflow.com/users/1172194/dinesh-arora" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-stack-overflow"></i></a>

        <a href="https://twitter.com/dinesh19aug" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-twitter"></i></a>

        <a href="https://github.com/dinesh19aug" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-github"></i></a>

        <a href="https://www.linkedin.com/in/dinesharora" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-linkedin"></i></a>

        <a href="https://github.com/dinesh19aug" class="w3-bar-item w3-button w3-hover-green"><i class="fa fa-github"></i></a>

      </span>

</div>
</div>
<br>
  <div class="w3-content">

  <div class="w3-container w3-center w3-padding-32 w3-hide-small">
      <h1 class="w3-xxxlarge w3-text-blue w3-wide w3-allerta  " style="text-shadow:1px 1px 0 #444" ><u>
      
         A Morsel Of Code - One Byte At A Time
      
</u></h1>

    </div>
    <div class="w3-content w3-center">
    <div class="w3-bar w3-light-grey w3-border">
    <a href="/" class="w3-bar-item w3-button w3-large w3-green"><i class="fa fa-home"></i></a>
    
      <a href="/categories/" class="w3-bar-item w3-button w3-hide-small">Categories</a>
    
      <a href="/tags/" class="w3-bar-item w3-button w3-hide-small">Tags</a>
    


    <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="displaymenu()">&#9776;</a>
  </div>

<div id="mobilemenu" class="w3-bar-block w3-light-grey w3-hide w3-hide-large w3-hide-medium">
  
      <a href="/categories/" class="w3-bar-item w3-button">Categories</a>
      
      <a href="/tags/" class="w3-bar-item w3-button">Tags</a>
      

</div>
</div>
</div>
<script>
function displaymenu() {
    var x = document.getElementById("mobilemenu");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>



  <div id="searchOverlay" class="overlay w3-hide">
    <span class="closebtn" onclick="displaysearch()" title="Close Overlay">×</span>
    <div class="overlay-content">
        <form action="/search/">
          <input type="text" placeholder="Search.." name="q">
          <button type="submit"><i class="fa fa-search"></i></button>
        </form>
    </div>
  </div>

  <script>
  function displaysearch() {
    var x = document.getElementById("searchOverlay");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }

  }


  </script>





    <hr class="headfoot">

      
    </header>
    
<div class="w3-content">
    
      <div>
        <div id="content" >
          
    

 
     


  <div class="w3-content w3-card-4" >
    
    <header class="w3-container w3-center w3-padding-32">
      <h1>4 ways to set up datasources in Jboss AS 7</h1>

      <div >
        <p> 2015-07-22 
          
             <code> 983 words  </code>
             <code> 5 mins read </code>
          
        </p>
        <div >
            
              <a class="w3-btn w3-small w3-round w3-green" href="/categories/tech-notes/"> Tech Notes </a>
            
          </div>
       
        
      </div>
    </header>

   
    
    <div class="w3-container">
      
        

        
        

        
          
          
          <p>Last year my company decided to move from JBoss 4.x/5.x to Jboss AS 7. We use Maven and IZPack plugin to create automated deployment to Jboss 4. As a part of IZPack plugin, we would write the install.xmls for various environment, which would help us deploy war files, log.xml, jars, properties file in respective folders. So the advantage was that Jboss-4 allows you to deploy several xxx-ds.xml files in deploy folder and you can have multiple apps deployed in same Jboss and each app uses it&#8217;s respective xxx-ds.xml file.</p>

<p>When we started with Jboss AS 7 we learnt that all datasource setting had to be done in <strong>standalone.xml</strong> file. <strong>Jboss 7.0 </strong> got rid of <strong>xxx-ds.xml</strong> file concept.  The problem with this approach was that we could not use <strong>IZPack</strong> plugin to replace the environment variable if we were deploying multiple apps in the Jboss because every IZPack installation would overwrite the previous <strong>standalone.xml</strong> setting for datasource section. So our deployment engineer had to manually go and configure each datasource in <strong>standalone.xml.</strong> God forbid when we have to update expiring passwords for database every few months, then changing all these passwords would have created a havoc.</p>

<p>As a result, we abandoned or let&#8217;s say delayed the Jboss4 to Jboss AS 7 upgrade. I was not involved in this first attempt however last week I had some time on hand so I started looking into the issue. It turns out the newer version of Jboss AS 7.1.1-FINAL had re-introduced the concept of deployable datasources.</p>

<p>&nbsp;</p>

<p>Let me walk you through <span style="text-decoration: underline;"><em><strong>4 ways</strong></em></span> of configuring the datasources in Jboss AS 7.1.1-FINAL.</p>

<p><strong>METHOD 1: Standard way. Setting up datasource using standalone.xml(</strong>Not preferred if you have multiple apps in the deployments folder). In this example let&#8217;s assume we are using <strong>Oracle database.</strong></p>

<p><strong>Step 1: </strong>Add the Ojdbc14.x.x  jar file in the folder</p>

<blockquote>
<p><code>Jboss/modules/com/oracle/jdbc/main</code></p>
</blockquote>

<p>Keep in mind that the folder structure is really important.</p>

<p><strong>Step 2:</strong> Create a file <strong>module.xml</strong> and it along with for jdbc jar file. Add the below xml in the module.xml file.</p>

<p id="rPkluam">
  <img class="alignnone size-full wp-image-830 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af119e4110d.png" alt="" />
</p>

<p>So in the above file, we are defining the location of the jar file in &lt;<strong>resource-root&gt; </strong>tag. You can actually put the jar file in some other folder as well and define the path here but that is not an advisable approach as you will have to provide the full path of the jar file which will cause issues if you have to move the Jboss folder to some other server location.</p>

<p><strong>Step 3: </strong>Open the <strong>standalone.xml</strong> file under jboss-as-7.1.0.Final\standalone\configuration folder. In the datasources section define datasources. EX:</p>

<p id="YfbyjeY">
  <img class="alignnone size-full wp-image-832 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af14ad4001c.png" alt="" />
</p>

<p>That&#8217;s it. But this is the standard way of adding the datasource. The next time I want to deploy another application in the same Jboss which uses MySQl, I would have to manually update the <strong>standalone.xml </strong>so that I do not change mess up the datasource set up for Oracle.</p>

<p>&nbsp;</p>

<p><strong>Method 2: Deploy datasource in stanadalone jar.</strong> Assume we are configuring for Oracle datasource.</p>

<p><strong>Step 1: </strong>Copy  ojdbc14.xx.jar in the Jboss/standalone/deployments folder.</p>

<blockquote>
<p><strong><code>cp ojdbc14.10.1.05.jar /usr/jboss-as-7.1.1.Final/standalone/deployments</code></strong></p>
</blockquote>

<p><strong>Step 3:</strong> Start the Jboss server to see if the jar file is successfully deployed.</p>

<p><code>&lt;strong&gt;09:32:10,400 INFO [org.jboss.as.server] (DeploymentScanner-threads - 2) JBAS018559:&lt;br /&gt;
Deployed &quot;mysql-connector-java-5.1.18-bin.jar&quot;&lt;/strong&gt;</code></p>

<p><strong>Step 4:</strong> Deploy the datasource file</p>

<p>Just fill in an xml file which ends (as we used to do) in -ds.xml, for example this is a oracle-ds.xml which is suitable for Oracle database. <strong> </strong></p>

<p id="tWWAqtZ">
  <img class="alignnone size-full wp-image-835 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af199091f99.png" alt="" />
</p>

<p><strong>Step 5:</strong> Deploy your web app and you are good to go.</p>

<p><strong>At this point you might wonder if there is any pitfall when using the older -ds.xml approach ? well actually if you &#8220;bypass&#8221; the management interface and deploy the datasource in the old way, you will not be able to manage it through the CLI or Web admin interface. As you can see from this snapshot, our datasource is not enlisted through the manageable resources of the Web interface.</strong></p>

<p>&nbsp;</p>

<p><strong>METHOD 3: Deploying the datasource along with your application</strong></p>

<p>You can actually deploy your datasource along with your application, just you used to do in the past.</p>

<p>Here&#8217;s a sample Web application Structure which ships with a datasource (in the WEB-INF folder). For other a JAR archive you would rather need copying the datasource in the META-INF folder:</p>

<p id="AlrPDRU">
  <img class="alignnone size-full wp-image-836 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af1b7284aa8.png" alt="" />
</p>

<p><strong>Method 4: Hybrid approach using *-ds.xml + standalone.xml</strong></p>

<p>I found this approach to be the best because I do not like put jar files inside a WAR applcation which is written in MAVEN. I also do not like to drop JDBC jar files in deployments folder as it I consider it a sacred place for WAR files only. So I figured out a hybrid approach.</p>

<p><strong>Step 1: </strong>Add the Ojdbc14.x.x  jar file in the folder</p>

<blockquote>
<p><code>Jboss/modules/com/oracle/jdbc/main</code></p>
</blockquote>

<p>Keep in mind that the folder structure is really important.</p>

<p><strong>Step 2:</strong> Create a file <strong>module.xml</strong> and it along with for jdbc jar file. Add the below xml in the module.xml file.</p>

<p id="rPkluam">
  <img class="alignnone size-full wp-image-830 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af119e4110d.png" alt="" />
</p>

<p>So in the above file, we are defining the location of the jar file in &lt;<strong>resource-root&gt; </strong>tag. You can actually put the jar file in some other folder as well and define the path here but that is not an advisable approach as you will have to provide the full path of the jar file which will cause issues if you have to move the Jboss folder to some other server location.</p>

<p><strong>Step 3: </strong>Open the <strong>standalone.xml</strong> file under jboss-as-7.1.0.Final\standalone\configuration folder. In the datasources section define datasources. Here you only define the drivers in the datasources section.</p>

<p id="oWTMQmR">
  <img class="alignnone size-full wp-image-837 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af1cb4962dc.png" alt="" />
</p>

<p>Notice that I have defined 2 drivers and have named them as &#8220;<strong>mssql</strong>&#8221; and &#8220;<strong>oracle</strong>&#8220;. Also notice the module, this is suppose to be exactly like the folder structure of jar file under <strong>jboss/modules </strong> section.</p>

<p><strong>Step 4: </strong>Create a <strong>xx-ds.xml </strong>file and drop it in deployments folder.</p>

<p id="QTrNkpa">
  <img class="alignnone size-full wp-image-838 " src="/placeholder.svg" data-src="http://javahabit.com/wp-content/uploads/2015/07/img_55af1dc878ffc.png" alt="" />
</p>

<p>Notice that I have commented out the <strong><drivers> section. </strong>The way Jboss figures out the driver is by looking at tag name <strong><driver>oracle</driver> </strong>in my <strong>xx-ds.xml.</strong></p>

<p>&nbsp;</p>

<p>That&#8217;s it.</p>

<p>~Ciao</p>

                 
                
         
      
    </div>

    
   

    <div class="w3-container">
    	
      
     
	</div>



  


    
    
    
    
    <br>  
</div>



<div class="w3-container w3-card-2 w3-black">
<div class="w3-row">
  <div class="w3-col l2 m2 s12 w3-center">
  
    <img src="https://avatars3.githubusercontent.com/u/1176242?s=460&amp;v=4" width ="100px" class="w3-circle w3-center w3-margin-top w3-margin-bottom" alt="author" >
   
  </div>
  <div class="w3-col l10 m10 s12 ">
  <div class = "w3-container w3-margin-top">
    
    
  </div>
  </div>
  </div>
</div>

      
    <div class="w3-content" > 
      <div class="w3-bar w3-section">
	     
	      <a  href="/2015/09/27/waffle-windows-single-sign-on/" class="w3-btn w3-text-indigo w3-hover-green">
	          &#10094; Waffle : Windows Single Sign On
	      </a>
	    
	      <a class="w3-btn w3-right w3-text-indigo w3-hover-green" href="/2015/04/23/powermock-how-to-test-a-private-method/">
	       PowerMock : How to test a private method &#10095;
	      </a>
  	  </div>
    </div>
	
 

  
  
  

      <div id="wrapads">
        <div class="adBanner">
         
        </div>
       </div>
      
      <div id="allowads" class="allowads-overlay">
  
        <div class="allowads-overlay-content">
        <div class="w3-panel w3-pink w3-large">
        

         <p> We notice you're using an adblocker.  If you like our webite please keep us running by whitelisting this site in your ad blocker. We’re serving quality, related ads only. Thank you!</p>
         
          <div class="w3-btn w3-green"  onclick="closeOverlay()">I've whitelisted your website.</div><br>
          <div class="w3-button w3-small"  onclick="closeOverlay()">Not now</div>
        </div>
        </div>
      </div>

      <script>
      function closeOverlay() {
        document.getElementById("allowads").style.width = "0%";
        document.getElementById("wrapads").style.height="1px";
      }

      function detectads() {
      var h = document.getElementById("wrapads").clientHeight;

      if (h==0){ document.getElementById("allowads").style.width = "100%";
      }
      }
      

     
      
      </script>
        </div>
        
          <script>
  shareurl=encodeURIComponent(location.protocol + '//' + location.host + location.pathname);
  sharetitle=encodeURIComponent(document.title);
    
  </script>
<div class="icon-bar">
<script>
document.write( '<a href="javascript:bookmark();" class="bookmark w3-tooltip"><i class="fa fa-bookmark"></i><span style="position:absolute;left:40px;bottom:18px" class="w3-text w3-small w3-tag w3-round w3-green ">Bookmark this page</span></a> ');

document.write( '<a href="http://www.facebook.com/sharer.php?u='+shareurl+'" onclick="window.open(this.href, \'mywin\',\'left=20,top=20,width=500,height=500,toolbar=1,resizable=0\'); return false;" class="facebook w3-tooltip"><i class="fa fa-facebook "></i><span style="position:absolute;left:40px;bottom:18px" class="w3-text w3-small w3-tag w3-round w3-green">Share to Facebook</span></a> ');

document.write( '<a href="https://twitter.com/share?url='+shareurl+'&amp;text='+sharetitle+'" onclick="window.open(this.href, \'mywin\',\'left=20,top=20,width=500,height=500,toolbar=1,resizable=0\'); return false;" class="twitter w3-tooltip"><i class="fa fa-twitter"></i><span style="position:absolute;left:40px;bottom:18px" class="w3-text w3-small w3-tag w3-round w3-green">Share to Twitter</span></a> ');
document.write( '<a href="https://plus.google.com/share?url='+shareurl+'" onclick="window.open(this.href, \'mywin\',\'left=20,top=20,width=500,height=500,toolbar=1,resizable=0\'); return false;" class="google w3-tooltip"><i class="fa fa-google"></i><span style="position:absolute;left:40px;bottom:18px" class="w3-text w3-small w3-tag w3-round w3-green">Share to Google Plus</span></a>');

document.write( '<a href="http://www.linkedin.com/shareArticle?mini=true&amp;url='+shareurl+'" onclick="window.open(this.href, \'mywin\',\'left=20,top=20,width=500,height=500,toolbar=1,resizable=0\'); return false;" class="linkedin w3-tooltip"><i class="fa fa-linkedin"></i><span style="position:absolute;left:40px;bottom:18px" class="w3-text w3-small w3-tag w3-round w3-green">Share to Linkedin</span></a>');

</script>

<script>
function bookmark(){

if ('sidebar' in window && 'addPanel' in window.sidebar) { 
                window.sidebar.addPanel(location.href,document.title,"");
            } else if(  false) { 
                window.external.AddFavorite(location.href,document.title); 
            } else { 
                alert('Press ' + (navigator.userAgent.toLowerCase().indexOf('mac') != - 1 ? 'Command/Cmd' : 'CTRL') + ' + D to bookmark this page.');
            }
        }

</script>
</div>
        
           
          
  

        
        
      </div>
    

   
    <footer id="footer" >
      <div class="w3-container w3-center w3-padding-32"> 
  
  <hr class="headfoot">
  <p>Powered by <a href="https://gohugo.io">Hugo</a> | Theme - <a href="https://github.com/jesselau76/hugo-w3-simple">Hugo W3 Simple</a>
  </p>
  &copy; <a href="http://javahabit.com">Dinesh Arora</a> 2019 | <a href="https://github.com/dinesh19aug">Github</a> | <a href="https://twitter.com/dinesh19aug">Twitter</a>  | <a href="/index.xml">RSS</a>
  
</div>

    </footer>
    

    
  </div>

  

  
    
      <div id="backtotop" class="w3-hide-small w3-hide-medium">
  
        <button onclick="topFunction()" class="w3-btn w3-red w3-large" style="width:160px">Back To Top
        &rarr;</button>
        
      </div>

      <script>
        function topFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
      }
      </script>


    
 
    
    <script>
    
    function isVisible(elem) {

      let coords = elem.getBoundingClientRect();

      let windowHeight = document.documentElement.clientHeight;

      
      let topVisible = coords.top > 0 && coords.top < windowHeight;
      let bottomVisible = coords.bottom < windowHeight && coords.bottom > 0;

      return topVisible || bottomVisible;
    }

    

    function showVisible() {
      for (let img of document.querySelectorAll('img')) {
        let realSrc = img.dataset.src;
        if (!realSrc) continue;

        if (isVisible(img)) {
          

          img.src = realSrc;

          img.dataset.src = '';
        }
      }
      if ( Array.from(document.querySelectorAll('[data-src]')).every(
        img => img.getAttribute('data-src') === '') ) {
        window.removeEventListener('scroll', showVisible)
      }

    }

    window.addEventListener('scroll', showVisible);
    showVisible();
  </script>


    
    
      <div class="progress-container" id="scrollbar">
        <div class="progress-bar" id="progress-bar"></div>
      </div>  


    
<script>

window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  <!-- TOC -->
    
    <!-- cookie bar -->
    
<!-- Back to top -->
    
    if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
        document.getElementById("backtotop").style.display = "block";
    } else {
        document.getElementById("backtotop").style.display = "none";
    }
    
    <!-- scroll indicator -->
    
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = (winScroll / height) * 100;
      document.getElementById("progress-bar").style.width = scrolled + "%";
      if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("scrollbar").style.display = "block";
        } else {
            document.getElementById("scrollbar").style.display = "none";
        }
    

    

    <!-- allowads -->
    
       if (document.body.scrollTop > 2000 || document.documentElement.scrollTop > 2000) {
          detectads();
       } 

    
}


</script>



  

</body>
</html>
